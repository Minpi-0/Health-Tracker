<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>K-Glow Tracker</title>
    <!-- Ê†∏ÂøÉÁ®ãÂºèÂ∫´ -->
    <script src="https://cdn.tailwindcss.com/"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        :root {
            --bg-color: #fbfbfe;
            --text-color: #040316; 
            --accent-color: #f9991a; 
            --gray-blue: #5a6a7a;
            --muted-gray: #9caeba;
            --radius-sheet: 16px; /* Ë¶ÅÊ±ÇÔºöÂúìËßíÁÇ∫ 16px */
            --ice-blue: rgba(233, 241, 251, 0.5);
        }

        body {
            font-family: 'PingFang TC', 'Poppins', 'Noto Sans TC', sans-serif;
            background-color: #e5e7eb;
            margin: 0;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            color: var(--text-color);
        }

        #root {
            width: 100%;
            max-width: 430px; 
            height: 100vh;
            height: 100dvh; 
            background-color: var(--bg-color);
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            background-image: url('https://raw.githubusercontent.com/Minpi-0/Health-Tracker/main/img/bg-mainpage.svg');
            background-size: cover;
            background-position: center;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        .premium-card {
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .tag-btn {
            padding: 0 16px; height: 36px; border-radius: 12px;
            font-size: 14px; font-weight: 700; border: 1px solid #e2e8f0;
            background-color: white; color: var(--muted-gray);
            transition: all 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 4px;
        }
        .tag-btn.active { background-color: var(--accent-color); border-color: var(--accent-color); color: white; }

        .equipment-block { background-color: #f1f5f9; border-radius: 16px; padding: 12px; margin-top: 8px; }
        
        .stepper-btn { width: 32px; height: 32px; background-color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--gray-blue); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        
        .note-textarea { height: 60px !important; min-height: 60px !important; padding: 12px !important; font-size: 14px; line-height: 1.5; border-radius: 12px; width: 100%; outline: none; border: none; }

        button.primary-btn { height: 48px; border-radius: 16px; font-size: 15px; font-weight: 700; background-color: var(--accent-color) !important; color: white !important; box-shadow: 0 4px 15px rgba(249, 153, 26, 0.3); border: none; }
        button.primary-btn:disabled { opacity: 0.7; background-color: #cbd5e1 !important; }

        .status-circle { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: transform 0.2s; }

        .island-navbar {
            position: absolute; bottom: 16px; left: 16px; right: 16px; height: 76px;
            background: rgba(255, 255, 255, 0.98); border-radius: 20px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
        }
        
        .glow-action-btn {
            width: 72px; height: 72px; background: linear-gradient(135deg, #fbbf24, #f9991a);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; box-shadow: 0 8px 30px rgba(249, 153, 26, 0.4);
            transform: translateY(-24px); border: 4px solid white;
        }

        .sheet-container { position: fixed; inset: 0; z-index: 1000; display: flex; align-items: flex-end; justify-content: center; pointer-events: none; }
        .sheet-backdrop { position: absolute; inset: 0; background: rgba(4, 3, 22, 0.4); backdrop-filter: blur(4px); pointer-events: auto; }
        
        .sheet-content {
            position: relative; z-index: 1010; width: 100%; max-width: 430px; background: white;
            border-top-left-radius: var(--radius-sheet); border-top-right-radius: var(--radius-sheet); 
            height: 75vh; /* Ë¶ÅÊ±ÇÔºöÈ´òÂ∫¶ 75% */
            display: flex; flex-direction: column; pointer-events: auto; animation: slide-up 0.35s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
        }

        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes fade-scale { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }

        .modal-center-content { animation: fade-scale 0.25s cubic-bezier(0.16, 1, 0.3, 1); pointer-events: auto; }

        .nutrient-bar-bg { height: 4px; background: #f1f5f9; border-radius: 10px; width: 100%; overflow: hidden; display: flex; gap: 2px; }
        .bar-p { background: #f9991a; height: 100%; }
        .bar-f { background: #9caeba; height: 100%; }
        .bar-c { background: #5a6a7a; height: 100%; }

        .timeline-date-chip { display: inline-block; padding: 4px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 100px; font-size: 12px; font-weight: 800; color: #5a6a7a; margin-bottom: 16px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }

        .touch-target { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        .margin-consistency { margin-bottom: 16px; }

        .exercise-item-card { background-color: white; border-radius: 16px; padding: 10px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.02); margin-bottom: 8px; border: 1px solid transparent; }
        .exercise-item-card.active { border-color: rgba(249, 153, 26, 0.3); background-color: #fffaf5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        // ‰øÆÂæ©ÔºöÊ®°ÁµÑÁí∞Â¢É‰∏ãÁöÑ React Ë≠òÂà•
        const React = window.React;
        const ReactDOM = window.ReactDOM;
        const { useState, useMemo, useEffect, useRef } = React;

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, query, onSnapshot, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Ë≤º‰∏äÂ¶≥ÁöÑ Firebase Config Âú®ÈÄôË£° ---
        const myFirebaseConfig = {
            apiKey: "AIzaSyBpCw2-cfSDaE0ABznkvULKD9sxgjlR9OI", // ‰æãÂ¶Ç: "AIzaSy..."
            authDomain: "health-tracker-ed193.firebaseapp.com",
            projectId: "health-tracker-ed193",
            storageBucket: "health-tracker-ed193.firebasestorage.app",
            messagingSenderId: "77615585267",
            appId: "1:77615585267:web:451f6672cc9834dc92a486"
        };

        // Firebase ÂàùÂßãÂåñ
        const firebaseConfig = myFirebaseConfig.apiKey ? myFirebaseConfig : (typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "" });
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'k-glow-tracker';

        // --- ÈáçË¶ÅÔºöÊ∏ÖÁêÜË≥áÊñô‰ª•Èò≤ Firebase Â†±ÈåØ ---
        const safeData = (obj) => {
            const clean = (o) => {
                const newObj = Array.isArray(o) ? [] : {};
                for (let key in o) {
                    let val = o[key];
                    if (val === undefined || (typeof val === 'number' && isNaN(val))) {
                        newObj[key] = null;
                    } else if (typeof val === 'object' && val !== null) {
                        newObj[key] = clean(val);
                    } else {
                        newObj[key] = val;
                    }
                }
                return newObj;
            };
            return clean(obj);
        };

        // --- Icon ÂÖÉ‰ª∂ ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const wrapperRef = useRef(null);
            useEffect(() => {
                if (window.lucide && wrapperRef.current) {
                    wrapperRef.current.innerHTML = `<i data-lucide="${name}"></i>`;
                    window.lucide.createIcons({ root: wrapperRef.current, attrs: { width: size, height: size, class: className } });
                }
            }, [name, size, className]);
            return React.createElement('span', { ref: wrapperRef, className: `inline-flex items-center justify-center shrink-0 ${className}` });
        };

        const PILATES_DATABASE = {
          "Ê†∏ÂøÉÂ∫ä (REFORMER)": ["Ë∂≥ÈÉ®Á∑¥Áøí", "ËÖøÈÉ®ÂúàÂúì", "Â§ßË±°Âºè", "Áü≠ÁÆ±Á≥ªÂàó", "ËÉåÈÉ®ÂàíËàπ"],
          "Âá±Ëø™ÊãâÂÖã (CADILLAC)": ["Êç≤Ë∫´‰∏ãÂ£ì", "Êé®Ê£íÈÅãÂãï", "Áå¥Â≠êÂºè", "ÂΩàÁ∞ßËÖøÂúà", "Â°îÂºèÈÅãÂãï"],
          "Á©©Ë∏èÊ§Ö (CHAIR)": ["Ë∏èÊùøÁ∑¥Áøí", "ÂºìÁÆ≠ÊâãÂºè", "Â§©ÈµùÂºè", "ÁôªÂ±±ËÄÖ", "Ê¥æÂÖãÂºè"],
          "Â¢ä‰∏ä / Ê¢ØÊ°∂ (MAT / BARREL)": ["‰∏ÄÁôæÊ¨°ÂëºÂê∏", "Êç≤Ë∫´‰∏äÊèö", "ÂñÆËÖø‰º∏Â±ï", "Â§©ÈµùË∑≥Ê∞¥", "È®éÈ¶¨Âºè"]
        };
        const DAILY_REINFORCEMENTS = [
          { name: 'Ê≠ªËü≤Âºè', sets: 3, reps: 12, explanation: 'Á©©ÂÆöÊ∑±Â±§Ê†∏ÂøÉÂü∫Á§é„ÄÇ' },
          { name: 'Ë≤ìÁâõÂºè', sets: 3, reps: 15, explanation: 'ÈáãÊîæËÑäÊ§éÂ£ìÂäõÔºåËàíÂ±ïËÇåËÇâ„ÄÇ' },
          { name: 'È≥•ÁãóÂºè', sets: 3, reps: 10, explanation: 'Âª∫Á´ãÂ∞çÂÅ¥Âπ≥Ë°°ÔºåÊîπÂñÑÈ´îÊÖã„ÄÇ' }
        ];

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [plans, setPlans] = useState([]);
            const [activePlanId, setActivePlanId] = useState(null);
            const [showEntryModal, setShowEntryModal] = useState(false);
            const [showPlanModal, setShowPlanModal] = useState(false);
            const [showConfirmModal, setShowConfirmModal] = useState(false);
            const [confirmAction, setConfirmAction] = useState(null);
            const [entryType, setEntryType] = useState('workout');
            const [historyFilterDate, setHistoryFilterDate] = useState(new Date().toISOString().split('T')[0]);
            const [weekOffset, setWeekOffset] = useState(0);

            // Ëá™Ë®ÇÂø´Êç∑È£üÁâ©
            const [quickFoods, setQuickFoods] = useState({ 
                breakfast: ["Ëç∑ÂåÖËõã", "Âú∞Áìú", "ÁÑ°Á≥ñË±ÜÊºø"], lunch: ["ÈõûËÉ∏ËÇâ", "ÂÅ•Â∫∑È§êÁõí", "Ê≤ôÊãâ"], 
                dinner: ["ÁáôÈùíËèú", "ÁÖéË±ÜËÖê", "Á≥ôÁ±≥È£Ø"], snacks: ["Â†ÖÊûú", "ÂÑ™Ê†º", "ËõãÁôΩÈ£≤"]
            });
            const [customFoodInput, setCustomFoodInput] = useState({ breakfast: '', lunch: '', dinner: '', snacks: '' });

            // Á¥ÄÈåÑË°®ÂñÆ
            const [editingId, setEditingId] = useState(null);
            const [w_date, setWDate] = useState(new Date().toISOString().split('T')[0]);
            const [d_date, setDDate] = useState(new Date().toISOString().split('T')[0]);
            const [w_parts, setWParts] = useState([]);
            const [w_category, setWCategory] = useState("Ê†∏ÂøÉÂ∫ä (REFORMER)");
            const [w_exercises, setWExercises] = useState([]);
            const [w_note, setWNote] = useState('');
            const [w_weight, setWWeight] = useState('');
            const [isEditingWeight, setIsEditingWeight] = useState(false);
            const [confirmAnim, setConfirmAnim] = useState(false);
            const [dietForm, setDietForm] = useState({ breakfast: '', lunch: '', dinner: '', snacks: '' });
            const [d_water, setDWater] = useState(200);
            const [isSaving, setIsSaving] = useState(false);

            // Ë®àÁï´Ë°®ÂñÆ
            const [editingPlanId, setEditingPlanId] = useState(null);
            const [newPlanTitle, setNewPlanTitle] = useState('');
            const [newPlanDate, setNewPlanDate] = useState('');
            const [newPlanBaselineWeight, setNewPlanBaselineWeight] = useState('');
            const [newPlanTargetWeight, setNewPlanTargetWeight] = useState('');

            // --- ÂäüËÉΩËàáËºîÂä©ÂáΩÂºè ---
            const closeModal = () => { 
                setShowEntryModal(false); setShowPlanModal(false); setEditingPlanId(null); setEditingId(null);
                setWNote(''); setWExercises([]); setWParts([]); setDietForm({ breakfast: '', lunch: '', dinner: '', snacks: '' });
                setDWater(200); setIsSaving(false);
            };

            const confirmDelete = (type, id, extra = null) => {
                setConfirmAction({ type, id, extra });
                setShowConfirmModal(true);
            };

            const handleHeaderPlusClick = () => {
                if (view === 'plan' || !activePlanId) {
                    setEditingPlanId(null); setNewPlanTitle(''); setNewPlanDate('');
                    setShowPlanModal(true);
                } else {
                    setEditingId(null); setEntryType(view === 'diet' ? 'diet' : 'workout');
                    setShowEntryModal(true);
                }
            };

            const handleQuickFoodSelect = (meal, food) => {
                setDietForm(p => ({ ...p, [meal]: p[meal] ? p[meal] + "„ÄÅ" + food : food }));
            };

            const handleEditRecord = (entry, type) => {
                setEntryType(type); setEditingId(entry.id);
                if (type === 'workout') { setWDate(entry.date); setWParts(entry.parts || []); setWExercises(entry.exercises || []); setWNote(entry.note || ''); }
                else { setDDate(entry.date); setDietForm({ breakfast: entry.breakfast, lunch: entry.lunch, dinner: entry.dinner, snacks: entry.snacks }); setDWater(entry.water); }
                setShowEntryModal(true);
            };

            const handleAddExercise = (name) => setWExercises(p => p.some(e => e.name === name) ? p.filter(e => e.name !== name) : [...p, { name, sets: 3, reps: 12 }]);
            const updateEx = (name, field, delta) => setWExercises(p => p.map(ex => ex.name === name ? { ...ex, [field]: Math.max(1, ex[field] + delta) } : ex));
            const watchYoutube = (name) => window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(name)}+pilates+tutorial`, '_blank');
            const handleEditPlan = (plan) => { setEditingPlanId(plan.id); setNewPlanTitle(plan.title); setNewPlanDate(plan.targetDate); setNewPlanBaselineWeight(plan.baselineWeight); setNewPlanTargetWeight(plan.targetWeight); setShowPlanModal(true); };

            // --- ÈÅãÁÆóÈÇèËºØ ---
            const activePlan = useMemo(() => plans.find(p => p.id === activePlanId) || null, [plans, activePlanId]);

            const weekDaysList = useMemo(() => {
                const now = new Date();
                const start = new Date(now);
                start.setDate(now.getDate() - now.getDay() + (weekOffset * 7));
                return Array.from({ length: 7 }, (_, i) => {
                    const d = new Date(start);
                    d.setDate(start.getDate() + i);
                    return { date: d.toISOString().split('T')[0], label: ['Êó•','‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠'][i], num: d.getDate() };
                });
            }, [weekOffset]);

            const currentMonthLabel = useMemo(() => {
                if (weekDaysList.length === 0) return "";
                const d = new Date(weekDaysList[0].date);
                return `${d.getMonth() + 1}Êúà Êú¨ÈÄ±`;
            }, [weekDaysList]);

            const getDayDietTotals = (date) => {
                const dayEntries = activePlan?.dietEntries?.filter(e => e.date === date) || [];
                return dayEntries.reduce((acc, curr) => ({
                    kcal: acc.kcal + (Number(curr.kcal) || 0), p: acc.p + (Number(curr.p) || 0), f: acc.f + (Number(curr.f) || 0), c: acc.c + (Number(curr.c) || 0), water: acc.water + (Number(curr.water) || 0)
                }), { kcal: 0, p: 0, f: 0, c: 0, water: 0 });
            };

            const getDayWorkoutTotals = (date) => {
                const dayEntries = activePlan?.workoutEntries?.filter(e => e.date === date) || [];
                const partsSet = new Set();
                let movesCount = 0;
                dayEntries.forEach(entry => {
                    if (entry.parts) entry.parts.forEach(p => partsSet.add(p));
                    if (entry.exercises) movesCount += entry.exercises.length;
                });
                return { count: dayEntries.length, parts: partsSet.size, moves: movesCount };
            };

            const dateStats = (dateStr) => {
                if (!activePlan) return { workout: false, diet: false };
                return {
                    workout: (activePlan.workoutEntries || []).some(e => e.date === dateStr),
                    diet: (activePlan.dietEntries || []).some(e => e.date === dateStr)
                };
            };

            const daysLeft = useMemo(() => {
                if (!activePlan || !activePlan.targetDate) return 0;
                const target = new Date(activePlan.targetDate);
                const today = new Date();
                today.setHours(0,0,0,0); target.setHours(0,0,0,0);
                return Math.max(0, Math.ceil((target - today) / (1000 * 60 * 60 * 24)));
            }, [activePlan]);

            const latestWeight = useMemo(() => activePlan?.workoutEntries?.find(e => e.weight > 0)?.weight || activePlan?.baselineWeight || 0, [activePlan]);

            const nutrientInsight = useMemo(() => {
                const t = getDayDietTotals(historyFilterDate);
                if (t.kcal === 0) return "‰ªäÂ§©ÈÇÑÊ≤íÊúâÁ¥ÄÈåÑÈ£≤È£üÂñî ‚ú®";
                return t.p > 60 ? "ËõãÁôΩË≥™ÂÖÖË∂≥ÔºÅËÇåËÇâÊ≠£Âú®ÊÑüË¨ùÂ¶≥ÔºÅüí™" : "ÊØî‰æã‰∏çÈåØÂñîÔºÅÁπºÁ∫åÊúùÁõÆÊ®ôÈÇÅÈÄ≤ÔºÅüåü";
            }, [activePlan, historyFilterDate, plans, activePlanId]);

            const todayReinforcement = useMemo(() => DAILY_REINFORCEMENTS[new Date(historyFilterDate).getDate() % DAILY_REINFORCEMENTS.length || 0], [historyFilterDate]);

            // --- Áï∞Ê≠•‰∫§‰∫í ---
            const executeDelete = async () => {
                if (!user || !confirmAction) return;
                const { type, id, extra } = confirmAction;
                if (type === 'plan') {
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'plans', id));
                    if (activePlanId === id) {
                        await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'profile'), { activePlanId: null }, { merge: true });
                        setActivePlanId(null);
                    }
                } else if (type === 'quickFood') {
                    setQuickFoods(prev => ({ ...prev, [extra]: prev[extra].filter(f => f !== id) }));
                } else if (activePlan) {
                    let updated = { ...activePlan };
                    if (type === 'workout') updated.workoutEntries = updated.workoutEntries.filter(e => e.id !== id);
                    if (type === 'diet') updated.dietEntries = updated.dietEntries.filter(e => e.id !== id);
                    await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'plans', activePlan.id), safeData(updated));
                }
                setShowConfirmModal(false);
            };

            const handleSaveEntry = async () => {
                if (!user || !activePlan) return;
                setIsSaving(true);
                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                let data = { kcal: 0, p: 0, f: 0, c: 0 };
                if (entryType === 'diet') {
                   const fullText = Object.values(dietForm).filter(v => !!v).join('Ôºå');
                   try {
                        const systemPrompt = "Â¶≥ÊòØ‰∏Ä‰ΩçÂ∞àÊ•≠ÁáüÈ§äÂ∏´„ÄÇË´ãË®àÁÆóÈ£≤È£üÊ∏ÖÂñÆÁöÑ„ÄéÁ∏ΩÁµê„ÄèÁáüÈ§äÔºöÁÜ±Èáè(kcal)„ÄÅËõãÁôΩË≥™(g)„ÄÅËÑÇËÇ™(g)„ÄÅÁ¢≥Ê∞¥(g)„ÄÇË´ãÂè™ÂõûÂÇ≥ JSON Ê†ºÂºèÔºö{\"kcal\": Êï∏ÂÄº, \"p\": Êï∏ÂÄº, \"f\": Êï∏ÂÄº, \"c\": Êï∏ÂÄº}„ÄÇ";
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${firebaseConfig.apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ contents: [{ parts: [{ text: `ÂÖßÂÆπÔºö${fullText}` }] }], systemInstruction: { parts: [{ text: systemPrompt }] }, generationConfig: { responseMimeType: "application/json" } })
                        });
                        const result = await response.json();
                        data = JSON.parse(result.candidates?.[0]?.content?.parts?.[0]?.text || "{}");
                    } catch (e) { data = { kcal: 0, p: 0, f: 0, c: 0 }; }
                }
                
                let updatedPlan = { ...activePlan };
                if (editingId) {
                    if (entryType === 'workout') {
                        updatedPlan.workoutEntries = updatedPlan.workoutEntries.map(e => e.id === editingId ? { ...e, date: w_date, parts: w_parts, exercises: w_exercises, note: w_note } : e);
                    } else {
                        updatedPlan.dietEntries = updatedPlan.dietEntries.map(e => e.id === editingId ? { ...e, date: d_date, ...dietForm, water: Number(d_water), kcal: data.kcal, p: data.p, f: data.f, c: data.c } : e);
                    }
                } else {
                    if (entryType === 'workout') {
                        updatedPlan.workoutEntries = [{ id: Date.now(), date: w_date, time, parts: w_parts, note: w_note, exercises: w_exercises, weight: latestWeight }, ...(updatedPlan.workoutEntries || [])];
                    } else {
                        updatedPlan.dietEntries = [{ id: Date.now(), date: d_date, time, ...dietForm, water: Number(d_water), kcal: data.kcal, p: data.p, f: data.f, c: data.c }, ...(updatedPlan.dietEntries || [])];
                    }
                }
                await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'plans', activePlan.id), safeData(updatedPlan));
                setIsSaving(false);
                closeModal();
            };

            const handleCreatePlan = async () => {
                if (!user || !newPlanTitle || !newPlanDate) return;
                setIsSaving(true);
                const planData = { 
                    title: newPlanTitle, targetDate: newPlanDate, 
                    baselineWeight: parseFloat(newPlanBaselineWeight) || 0, 
                    targetWeight: parseFloat(newPlanTargetWeight) || 0, 
                    workoutEntries: [], dietEntries: [] 
                };
                if (editingPlanId) {
                    await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'plans', editingPlanId), safeData(planData));
                } else {
                    const docRef = await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'plans'), safeData(planData));
                    await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'profile'), { activePlanId: docRef.id }, { merge: true });
                }
                setIsSaving(false);
                closeModal();
                setView('home');
            };

            const handleSaveWeight = async (val) => {
                if (!user || !activePlan) return;
                const w = parseFloat(val); if (isNaN(w) || w <= 0) return;
                setConfirmAnim(true);
                const updated = { ...activePlan, workoutEntries: [{ id: Date.now(), date: new Date().toISOString().split('T')[0], weight: w, time: 'Êó©‰∏ä', note: '‰ªäÊó•Á®±Èáç' }, ...(activePlan.workoutEntries || [])] };
                await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'plans', activePlan.id), safeData(updated));
                setTimeout(() => { setConfirmAnim(false); setIsEditingWeight(false); }, 800);
            };

            // --- Auth & Sync ---
            useEffect(() => {
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); } 
                    else { await signInAnonymously(auth); }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'plans'));
                const unsubPlans = onSnapshot(q, (snapshot) => { setPlans(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))); });
                const unsubSettings = onSnapshot(doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'profile'), (doc) => { if (doc.exists()) setActivePlanId(doc.data().activePlanId); });
                return () => { unsubPlans(); unsubSettings(); };
            }, [user]);

            // --- Ê∏≤ÊüìÂç°ÁâáÁµÑ‰ª∂ ---
            const renderDietCardComponent = (entry) => {
                const totalMacros = (entry.p || 0) + (entry.f || 0) + (entry.c || 0) || 1;
                return React.createElement('div', { key: entry.id, className: "premium-card p-4 margin-consistency text-[#040316]" },
                    React.createElement('div', { className: "flex justify-between items-center mb-3 text-brand" },
                        React.createElement('span', { className: "text-[12px] font-bold text-[#9caeba] flex items-center gap-1.5" }, React.createElement(Icon, { name: "clock", size: 12 }), entry.time),
                        React.createElement('div', { className: "flex items-center -mr-2" },
                            React.createElement('button', { onClick: () => handleEditRecord(entry, 'diet'), className: "touch-target text-[#9caeba] active:text-[#f9991a] transition-all" }, React.createElement(Icon, { name: "edit-3", size: 24 })),
                            React.createElement('button', { onClick: () => confirmDelete('diet', entry.id), className: "touch-target text-[#9caeba] active:text-red-400" }, React.createElement(Icon, { name: "trash-2", size: 24 }))
                        )
                    ),
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "flex flex-wrap gap-2 text-brand" },
                            ['breakfast', 'lunch', 'dinner', 'snacks'].map(meal => entry[meal] && React.createElement('div', { key: meal, className: "flex items-center gap-1.5 bg-gray-50 px-3 py-1.5 rounded-xl border border-gray-100/50" },
                                React.createElement(Icon, { name: meal === 'breakfast' ? 'sun' : meal === 'lunch' ? 'sun-medium' : meal === 'dinner' ? 'moon' : 'coffee', size: 14, className: "text-[#9caeba]" }),
                                React.createElement('span', { className: "text-[14px] font-bold leading-none" }, entry[meal])
                            ))
                        ),
                        React.createElement('div', { className: "pt-2 border-t border-dashed border-gray-200 flex items-center justify-between text-[12px] font-bold text-[#5a6a7a] text-brand" },
                            React.createElement('div', { className: "flex gap-3" }, React.createElement('span', { className: "text-[#f9991a]" }, `P ${entry.p}g`), React.createElement('span', { className: "text-[#9caeba]" }, `F ${entry.f}g`), React.createElement('span', null, `C ${entry.c}g`)),
                            React.createElement('div', { className: "flex items-center gap-1.5 text-blue-400" }, React.createElement(Icon, { name: "droplets", size: 12 }), `${entry.water}cc`)
                        ),
                        React.createElement('div', { className: "flex items-center gap-4 text-brand" },
                            React.createElement('div', { className: "nutrient-bar-bg flex-1" },
                                React.createElement('div', { className: "bar-p", style: { width: `${((entry.p || 0) / totalMacros) * 100}%` } }),
                                React.createElement('div', { className: "bar-f", style: { width: `${((entry.f || 0) / totalMacros) * 100}%` } }),
                                React.createElement('div', { className: "bar-c", style: { width: `${((entry.c || 0) / totalMacros) * 100}%` } })
                            ),
                            React.createElement('div', { className: "text-[15px] font-bold whitespace-nowrap" }, `${entry.kcal} `, React.createElement('span', { className: "text-[10px] text-[#9caeba] uppercase tracking-tighter" }, "kcal"))
                        )
                    )
                );
            };

            const renderWorkoutCardComponent = (entry) => React.createElement('div', { key: entry.id, className: "premium-card p-4 margin-consistency text-[#040316]" },
                React.createElement('div', { className: "flex justify-between items-center mb-2 text-brand" },
                    React.createElement('span', { className: "text-[12px] font-bold text-[#9caeba] flex items-center gap-1.5" }, React.createElement(Icon, { name: "clock", size: 12 }), entry.time),
                    React.createElement('div', { className: "flex items-center -mr-2" },
                        React.createElement('button', { onClick: () => handleEditRecord(entry, 'workout'), className: "touch-target text-[#9caeba] active:text-[#f9991a]" }, React.createElement(Icon, { name: "edit-3", size: 24 })),
                        React.createElement('button', { onClick: () => confirmDelete('workout', entry.id), className: "touch-target text-[#9caeba] active:text-red-400" }, React.createElement(Icon, { name: "trash-2", size: 24 }))
                    )
                ),
                React.createElement('div', { className: "space-y-3 text-brand" },
                    React.createElement('div', { className: "space-y-2.5" }, entry.exercises?.map((ex, idx) => React.createElement('div', { key: idx, className: "flex justify-between items-center py-2.5 px-3 bg-orange-50/50 rounded-xl border border-orange-100/30" },
                        React.createElement('span', { className: "text-[14px] font-bold" }, ex.name),
                        React.createElement('span', { className: "text-[12px] font-bold text-[#f9991a] bg-white px-2 py-0.5 rounded-lg border border-orange-100 uppercase tracking-tight" }, `${ex.sets}ÁµÑ / ${ex.reps}Ê¨°`)
                    ))),
                    React.createElement('div', { className: "flex flex-wrap gap-1.5 pt-1" }, entry.parts?.map(p => React.createElement('span', { key: p, className: "text-[11px] font-bold bg-[#f2f4f7] text-[#9caeba] px-2.5 py-1 rounded-full uppercase tracking-widest" }, p))),
                    entry.note && React.createElement('p', { className: "text-[13px] text-[#5a6a7a] italic mt-2 border-l-4 border-orange-100/50 pl-3 leading-relaxed bg-orange-50/20 py-2 rounded-r-lg" }, entry.note)
                )
            );

            const groupedRecordsUI = useMemo(() => {
                if (!activePlan) return null;
                const entries = view === 'history' ? (activePlan.workoutEntries || []) : (activePlan.dietEntries || []);
                const groups = entries.reduce((acc, entry) => {
                    if (!acc[entry.date]) acc[entry.date] = [];
                    acc[entry.date].push(entry);
                    return acc;
                }, {});
                return Object.keys(groups).sort((a, b) => new Date(b) - new Date(a)).map(date => React.createElement('div', { key: date },
                    React.createElement('div', { className: "timeline-date-chip margin-consistency" }, date === new Date().toISOString().split('T')[0] ? '‰ªäÂ§©' : date),
                    groups[date].sort((a, b) => (b.time || '').localeCompare(a.time || '')).map(item => view === 'history' ? renderWorkoutCardComponent(item) : renderDietCardComponent(item))
                ));
            }, [activePlan, view, historyFilterDate]);

            // --- ËøîÂõû JSX ---
            return React.createElement('div', { id: "root" },
                // Header
                React.createElement('header', { className: `z-30 transition-all ${view === 'home' ? 'p-4' : 'sticky top-0 bg-white/60 backdrop-blur-xl border-b border-gray-100/50 px-4 h-[64px] flex items-center'}` },
                    view === 'home' ? React.createElement('div', { className: "space-y-4 w-full text-[#5a6a7a]" },
                        React.createElement('div', { className: "flex justify-between items-center" },
                            React.createElement('div', { className: "flex items-center gap-3 text-brand" },
                                React.createElement('div', { className: "w-14 h-14 rounded-full border-2 border-white shadow-md overflow-hidden bg-white" }, React.createElement('img', { src: "https://raw.githubusercontent.com/Minpi-0/Health-Tracker/main/img/avatar-myself.svg", alt: "avatar" })),
                                React.createElement('div', { className: "flex flex-col" },
                                    React.createElement('h2', { className: "text-[20px] font-bold leading-tight" }, "Hello Min!"),
                                    activePlan && React.createElement('div', { className: "text-[14px] font-medium text-[#94a3b8] flex items-center" }, "ÁõÆÂâç ", React.createElement('span', { className: "text-[#f9991a] mx-1 font-bold" }, latestWeight), React.createElement('span', { className: "mx-1 opacity-30" }, "|"), " ÂàùÂßã ", activePlan.baselineWeight)
                                )
                            ),
                            activePlan && React.createElement('div', { className: "flex gap-2.5" },
                                React.createElement('div', { className: "status-circle bg-white text-[#f9991a] font-bold" }, activePlan.targetWeight),
                                React.createElement('div', { className: "status-circle bg-[#f9991a] text-white font-bold" }, `-${daysLeft}`)
                            )
                        ),
                        React.createElement('div', { className: "bg-white/30 backdrop-blur-md border border-white/20 rounded-[16px] p-4 shadow-sm" },
                            React.createElement('div', { className: "flex justify-between items-center mb-3 text-[11px] font-bold uppercase tracking-wider text-brand" },
                                React.createElement('span', { className: "text-[14px] text-[#f9991a] font-bold" }, currentMonthLabel),
                                React.createElement('div', { className: "flex gap-4" }, 
                                    React.createElement('div', { onClick: () => setWeekOffset(v => v - 1), className: "cursor-pointer active:scale-90" }, React.createElement(Icon, { name: "chevron-left", size: 16 })), 
                                    React.createElement('div', { onClick: () => setWeekOffset(v => v + 1), className: "cursor-pointer active:scale-90" }, React.createElement(Icon, { name: "chevron-right", size: 16 }))
                                )
                            ),
                            React.createElement('div', { className: "flex justify-between items-center px-1 text-brand" }, weekDaysList.map(day => {
                                const { workout, diet } = dateStats(day.date);
                                const isSelected = historyFilterDate === day.date;
                                return React.createElement('div', { key: day.date, className: "flex flex-col items-center gap-1.5 cursor-pointer", onClick: () => setHistoryFilterDate(day.date) },
                                    React.createElement('span', { className: "text-[10px] font-bold text-[#9caeba]" }, day.label),
                                    React.createElement('div', { className: `w-[42px] h-[42px] rounded-xl flex items-center justify-center font-bold text-[14px] transition-all ${isSelected ? 'border-2 border-[#f9991a] text-[#f9991a] bg-white shadow-sm' : (workout || diet) ? 'bg-[#f9991a] text-white' : 'bg-gray-100/50 text-[#9caeba]'}` }, day.num)
                                );
                            }))
                        )
                    ) : React.createElement('div', { className: "flex-1 flex items-center justify-between relative h-full text-brand" },
                        React.createElement('div', { className: "w-10 text-brand" }),
                        React.createElement('h1', { className: "absolute left-1/2 -translate-x-1/2 text-[18px] font-bold text-[#5a6a7a] whitespace-nowrap" }, view === 'plan' ? 'Ë®àÁï´ÁÆ°ÁêÜ' : view === 'history' ? 'ÈÅãÂãïÂõûÈ°ß' : 'È£≤È£üÁµ±Ë®à'),
                        React.createElement('button', { onClick: handleHeaderPlusClick, className: "header-plus-circle relative z-10 text-brand" }, React.createElement(Icon, { name: "plus", size: 24 }))
                    )
                ),

                // Main
                React.createElement('main', { className: "flex-1 overflow-y-auto px-4 pt-4 no-scrollbar pb-[120px]" },
                    activePlanId ? (
                        (view === 'home') ? React.createElement(React.Fragment, null,
                            React.createElement('section', { className: "premium-card p-4 flex items-center justify-between text-[#040316] margin-consistency" },
                                React.createElement('p', { className: "text-[16px] font-bold text-[#7a8b9a]" }, "Êó©Êô®ÁöÑÊàë"),
                                React.createElement('div', { className: `flex-1 mx-4 bg-[#f2f7ff] rounded-[16px] h-10 flex items-center justify-center transition-all ${confirmAnim ? 'scale-105 bg-orange-50 shadow-inner' : ''}` },
                                    isEditingWeight ? React.createElement('input', { autoFocus: true, type: "number", step: "0.1", value: w_weight, onChange: e => setWWeight(e.target.value), onBlur: () => handleSaveWeight(w_weight), className: "bg-transparent w-full text-center text-[18px] font-bold outline-none" }) : React.createElement('p', { className: "text-[18px] font-bold" }, `${latestWeight} `, React.createElement('span', { className: "text-[14px] font-bold text-[#9caeba] ml-1" }, "kg"))
                                ),
                                !isEditingWeight && React.createElement('div', { onClick: () => setIsEditingWeight(true), className: "cursor-pointer p-1 text-[#9caeba]" }, React.createElement(Icon, { name: "edit-3", size: 18 }))
                            ),
                            React.createElement('section', { className: "premium-card p-5 shadow-sm relative overflow-hidden margin-consistency", style: { backgroundImage: `url('https://raw.githubusercontent.com/Minpi-0/Health-Tracker/main/img/bg-mission.svg')`, backgroundSize: 'cover', backgroundPosition: 'center', border: 'none' } },
                                React.createElement('div', { className: "relative z-10 flex flex-col gap-3 text-[#040316]" },
                                    React.createElement('p', { className: "text-[13px] font-bold text-[#5a6a7a]" }, "‰ªäÊó•ÊåëÊà∞ÔºÅ"),
                                    React.createElement('div', { className: "flex items-center gap-3 text-brand" }, React.createElement('h2', { className: "text-[24px] font-bold text-[#f9991a] leading-none text-brand" }, todayReinforcement.name), React.createElement('span', { className: "px-3 py-1 bg-[#fff7ed] text-[#f9991a] text-[12px] font-bold rounded-lg border border-orange-100" }, "12x3ÁµÑ")),
                                    React.createElement('p', { className: "text-[14px] text-[#5a6a7a] leading-relaxed font-medium" }, todayReinforcement.explanation),
                                    React.createElement('div', { className: "flex gap-3 pt-2 text-brand" },
                                        React.createElement('button', { onClick: () => window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(todayReinforcement.name)}`, '_blank'), className: "flex-1 h-11 border-2 border-[#f9991a] text-[#f9991a] bg-white/80 rounded-full font-bold text-[14px] active:scale-95" }, "Â≠∏Âãï‰Ωú"),
                                        React.createElement('button', { onClick: () => { setEntryType('workout'); setEditingId(null); setWNote(`Ë£úÂº∑Ôºö${todayReinforcement.name}`); setShowEntryModal(true); }, className: "flex-1 h-11 bg-[#f9991a] text-white rounded-full font-bold text-[14px] shadow-lg active:scale-95" }, "ÊâìÂç°")
                                    )
                                )
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4 margin-consistency text-brand" },
                                React.createElement('button', { onClick: () => setView('history'), className: "premium-card p-5 flex flex-col items-center gap-3 active:scale-95 shadow-sm" }, React.createElement(Icon, { name: "dumbbell", size: 26, className: "text-[#f9991a]" }), React.createElement('p', { className: "text-[16px] font-bold text-[#7a8b9a]" }, "Ë®ìÁ∑¥Êó•Ë™å")),
                                React.createElement('button', { onClick: () => setView('diet'), className: "premium-card p-5 flex flex-col items-center gap-3 active:scale-95 shadow-sm" }, React.createElement(Icon, { name: "utensils", size: 26, className: "text-[#5a6a7a]" }), React.createElement('p', { className: "text-[16px] font-bold text-[#7a8b9a]" }, "È£≤È£üÁ¥ÄÈåÑ"))
                            )
                        ) : (view === 'history' || view === 'diet') ? React.createElement('div', { className: "space-y-0 text-brand" },
                            React.createElement('div', { className: "premium-card p-5 bg-white shadow-md text-[#040316] space-y-4 margin-consistency" },
                                React.createElement('div', { className: "flex justify-between items-center text-brand" },
                                    React.createElement('span', { className: "text-[12px] font-bold text-[#9caeba] uppercase tracking-widest" }, view === 'history' ? 'Ë®ìÁ∑¥ÊëòË¶Å' : 'ÁáüÈ§äÊëòË¶Å'),
                                    React.createElement('span', { className: "text-[14px] font-bold text-blue-400 flex items-center gap-1" }, React.createElement(Icon, { name: view === 'history' ? 'dumbbell' : 'droplets', size: 14 }), view === 'history' ? `${getDayWorkoutTotals(historyFilterDate).count} Á≠Ü` : `${getDayDietTotals(historyFilterDate).water} cc`)
                                ),
                                view === 'history' ? React.createElement('div', { className: "grid grid-cols-3 gap-2 text-brand" },
                                    React.createElement('div', { className: "bg-orange-50/50 rounded-xl p-3 flex flex-col items-center border border-orange-100/50" }, React.createElement('span', { className: "text-[10px] font-bold text-[#f9991a] uppercase mb-1" }, "Âãï‰ΩúÊï∏"), React.createElement('span', { className: "text-[15px] font-bold" }, getDayWorkoutTotals(historyFilterDate).moves)),
                                    React.createElement('div', { className: "bg-blue-50/50 rounded-xl p-3 flex flex-col items-center border border-blue-100" }, React.createElement('span', { className: "text-[10px] font-bold text-[#5a6a7a] uppercase mb-1" }, "ÈÉ®‰ΩçÊï∏"), React.createElement('span', { className: "text-[15px] font-bold" }, getDayWorkoutTotals(historyFilterDate).parts)),
                                    React.createElement('div', { className: "bg-gray-50 rounded-xl p-3 flex flex-col items-center border border-gray-100" }, React.createElement('span', { className: "text-[10px] font-bold text-[#9caeba] uppercase mb-1" }, "ÁãÄÊÖã"), React.createElement('span', { className: "text-[15px] font-bold" }, "Good"))
                                ) : React.createElement('div', { className: "grid grid-cols-4 gap-1.5 text-brand" },
                                    React.createElement('div', { className: "bg-orange-50/50 rounded-xl p-2.5 flex flex-col items-center border border-orange-100/50" }, React.createElement('span', { className: "text-[10px] font-bold text-[#f9991a] mb-1" }, "ÁÜ±Èáè"), React.createElement('span', { className: "text-[14px] font-bold" }, getDayDietTotals(historyFilterDate).kcal)),
                                    React.createElement('div', { className: "bg-blue-50/50 rounded-xl p-2.5 flex flex-col items-center border border-blue-100" }, React.createElement('span', { className: "text-[10px] font-bold text-[#5a6a7a] mb-1" }, "ËõãÁôΩ"), React.createElement('span', { className: "text-[14px] font-bold" }, `${getDayDietTotals(historyFilterDate).p}g`)),
                                    React.createElement('div', { className: "bg-gray-50 rounded-xl p-2.5 flex flex-col items-center border border-gray-100" }, React.createElement('span', { className: "text-[10px] font-bold text-[#9caeba] mb-1" }, "ËÑÇËÇ™"), React.createElement('span', { className: "text-[14px] font-bold" }, `${getDayDietTotals(historyFilterDate).f}g`)),
                                    React.createElement('div', { className: "bg-gray-50 rounded-xl p-2.5 flex flex-col items-center border border-gray-100" }, React.createElement('span', { className: "text-[10px] font-bold text-[#9caeba] mb-1" }, "Á¢≥Ê∞¥"), React.createElement('span', { className: "text-[14px] font-bold" }, `${getDayDietTotals(historyFilterDate).c}g`))
                                ),
                                React.createElement('div', { className: "bg-[#f2f4f7] p-3 rounded-xl text-brand" }, React.createElement('p', { className: "text-[12px] italic font-medium text-[#5a6a7a]" }, `„Äå${nutrientInsight}„Äç`))
                            ),
                            groupedRecordsUI
                        ) : (view === 'plan') ? React.createElement('div', { className: "space-y-0 text-brand" }, plans.map(p => React.createElement('div', { key: p.id, className: "premium-card p-5 margin-consistency shadow-sm text-[#040316]" },
                            React.createElement('div', { className: "flex justify-between items-start mb-4" },
                                React.createElement('div', { className: "flex flex-col gap-1" }, React.createElement('h3', { className: "text-[18px] font-bold tracking-tight" }, p.title), React.createElement('div', { className: "flex items-center gap-2 text-[14px] font-bold text-[#9caeba]" }, React.createElement(Icon, { name: "calendar", size: 12 }), `${p.targetDate} Êà™Ê≠¢`)),
                                React.createElement('div', { className: "flex gap-1 -mr-2" }, React.createElement('button', { onClick: () => handleEditPlan(p), className: "touch-target text-[#9caeba] active:text-[#f9991a]" }, React.createElement(Icon, { name: "edit-3", size: 24 })), React.createElement('button', { onClick: () => confirmDelete('plan', p.id), className: "touch-target text-[#9caeba] active:text-red-400" }, React.createElement(Icon, { name: "trash-2", size: 24 })))
                            ),
                            React.createElement('div', { className: "bg-blue-50/50 rounded-[12px] p-4 mb-4 flex items-center justify-between border border-white/40 text-[14px]" },
                                React.createElement('div', { className: "flex flex-col items-center flex-1" }, React.createElement('span', { className: "text-[14px] font-bold text-[#9caeba] uppercase mb-1" }, "Ëµ∑Âßã"), React.createElement('span', { className: "font-bold text-[#5a6a7a]" }, `${p.baselineWeight} kg`)),
                                React.createElement(Icon, { name: "chevron-right", size: 16, className: "text-[#9caeba] opacity-30 mx-2" }),
                                React.createElement('div', { className: "flex flex-col items-center flex-1" }, React.createElement('span', { className: "text-[14px] font-bold text-[#f9991a] uppercase mb-1" }, "ÁõÆÊ®ô"), React.createElement('span', { className: "font-bold text-[#f9991a]" }, `${p.targetWeight} kg`))
                            ),
                            activePlanId !== p.id ? React.createElement('button', { onClick: async () => { await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'profile'), { activePlanId: p.id }, { merge: true }); setView('home'); }, className: "primary-btn w-full text-white font-bold" }, "ÂïüÂãïË®àÁï´") : React.createElement('div', { className: "flex items-center justify-center gap-2 text-[#f9991a] font-bold text-[14px] py-2 bg-orange-50 rounded-[12px]" }, React.createElement(Icon, { name: "check-circle", size: 16 }), " ÁõÆÂâçÂü∑Ë°å‰∏≠")
                        ))) : null
                    ) : React.createElement('div', { className: "flex-1 flex flex-col items-center justify-center min-h-[460px] relative overflow-hidden bg-transparent text-brand" },
                        React.createElement('div', { className: "flex flex-col items-center gap-8 relative z-20 text-[#040316]" }, React.createElement('h2', { className: "text-[16px] font-bold text-[#334155] tracking-wide text-center" }, "ÊâìÈÄ†Â¶≥ÁöÑÂ∞àÂ±¨Ë®àÁï´"), React.createElement('button', { onClick: handleHeaderPlusClick, className: "primary-btn px-20 shadow-xl text-white active:scale-95" }, "ÂïüÂãïËÆäÁæé‰πãÊóÖ")),
                        React.createElement('div', { className: "absolute bottom-0 left-0 right-0 h-[220px] pointer-events-none mb-[-50px] z-10 flex items-center justify-center" }, React.createElement('lottie-player', { src: "https://raw.githubusercontent.com/Minpi-0/Health-Tracker/main/img/Sunrise%20-%20Breathe%20in%20Breathe%20out.json", background: "transparent", speed: "1", loop: true, autoplay: true, style: { width: '100%', height: '100%' } }))
                    )
                ),

                // Navbar
                React.createElement('nav', { className: "island-navbar text-[#9caeba] text-brand" },
                    React.createElement('div', { className: "flex flex-1 justify-around items-center" },
                        React.createElement('button', { onClick: () => setView('home'), className: `flex flex-col items-center gap-0.5 transition-all ${view === 'home' ? 'text-[#f9991a] scale-105' : 'opacity-60'}` }, React.createElement(Icon, { name: "home", size: 24 }), React.createElement('span', { className: "text-[12px] font-bold tracking-tight" }, "È¶ñÈ†Å")),
                        React.createElement('button', { onClick: () => setView('history'), className: `flex flex-col items-center gap-0.5 transition-all ${view === 'history' ? 'text-[#f9991a] scale-105' : 'opacity-60'}` }, React.createElement(Icon, { name: "activity", size: 24 }), React.createElement('span', { className: "text-[12px] font-bold tracking-tight" }, "ÈÅãÂãï"))
                    ),
                    React.createElement('button', { onClick: handleHeaderPlusClick, className: "glow-action-btn shadow-xl active:scale-90 text-white font-bold tracking-widest text-[16px] text-brand" }, activePlanId ? React.createElement(Icon, { name: "plus", size: 32 }) : "GO!"),
                    React.createElement('div', { className: "flex flex-1 justify-around items-center text-brand" },
                        React.createElement('button', { onClick: () => setView('diet'), className: `flex flex-col items-center gap-0.5 transition-all ${view === 'diet' ? 'text-[#f9991a] scale-105' : 'opacity-60'}` }, React.createElement(Icon, { name: "utensils", size: 24 }), React.createElement('span', { className: "text-[12px] font-bold tracking-tight" }, "È£≤È£ü")),
                        React.createElement('button', { onClick: () => setView('plan'), className: `flex flex-col items-center gap-0.5 transition-all ${view === 'plan' ? 'text-[#f9991a] scale-105' : 'opacity-60'}` }, React.createElement(Icon, { name: "clipboard", size: 24 }), React.createElement('span', { className: "text-[12px] font-bold tracking-tight" }, "Ë®àÁï´"))
                    )
                ),

                // Modals
                showEntryModal && React.createElement('div', { className: "sheet-container text-[#040316]" },
                    React.createElement('div', { className: "sheet-backdrop", onClick: closeModal }),
                    React.createElement('div', { className: "sheet-content" },
                        React.createElement('header', { className: "h-[64px] px-4 flex justify-between items-center border-b border-gray-50 bg-white sticky top-0 z-20 text-brand" },
                            React.createElement('div', { className: "w-10 text-brand" }),
                            React.createElement('h3', { className: "text-[18px] font-bold text-[#5a6a7a] text-brand" }, editingId ? 'Á∑®ËºØÁ¥ÄÈåÑ' : 'Êñ∞Â¢ûÁ¥ÄÈåÑ'),
                            React.createElement('div', { onClick: closeModal, className: "touch-target text-[#9caeba]" }, React.createElement(Icon, { name: "x", size: 24 }))
                        ),
                        React.createElement('div', { className: "flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar text-brand" },
                            !editingId && React.createElement('div', { className: "flex bg-gray-100 p-1 rounded-xl" },
                                React.createElement('button', { onClick: () => setEntryType('workout'), className: `flex-1 h-[32px] rounded-[10px] text-[13px] font-bold transition-all ${entryType === 'workout' ? 'bg-white shadow-sm text-[#040316]' : 'text-[#9caeba]'}` }, "Ë®ìÁ∑¥È†ÖÁõÆ"),
                                React.createElement('button', { onClick: () => setEntryType('diet'), className: `flex-1 h-[32px] rounded-[10px] text-[13px] font-bold transition-all ${entryType === 'diet' ? 'bg-white shadow-sm text-[#040316]' : 'text-[#9caeba]'}` }, "È£≤È£üÈ§êÈªû")
                            ),
                            React.createElement('div', { className: "space-y-4" },
                                React.createElement('div', null, React.createElement('span', { className: "text-[16px] font-bold text-[#5a6a7a] mb-2 block" }, "Á¥ÄÈåÑÊó•Êúü"), React.createElement('input', { type: "date", value: entryType === 'workout' ? w_date : d_date, onChange: e => entryType === 'workout' ? setWDate(e.target.value) : setDDate(e.target.value), className: "px-[12px] h-11 bg-blue-50/50 rounded-xl w-full border-none outline-none" })),
                                entryType === 'workout' ? React.createElement('div', { className: "space-y-4 text-brand" },
                                    React.createElement('div', null, React.createElement('span', { className: "text-[16px] font-bold text-[#5a6a7a] mb-2 block" }, "Âãï‰ΩúÊ∏ÖÂñÆ"), React.createElement('div', { className: "flex gap-2 overflow-x-auto no-scrollbar mb-3" }, Object.keys(PILATES_DATABASE).map(cat => React.createElement('button', { key: cat, onClick: () => setWCategory(cat), className: `tag-btn ${w_category === cat ? 'active' : ''}` }, cat.split(' ')[0]))), React.createElement('div', { className: "equipment-block" }, PILATES_DATABASE[w_category].map(move => {
                                        const cE = w_exercises.find(e => e.name === move); const isS = !!cE;
                                        return React.createElement('div', { key: move, className: `exercise-item-card ${isS ? 'active' : ''}` },
                                            React.createElement('div', { className: "flex items-center justify-between w-full" },
                                                React.createElement('div', { className: "flex items-center gap-4 flex-1 cursor-pointer", onClick: () => handleAddExercise(move) }, React.createElement('div', { className: `plus-box ${isS ? 'active' : ''}` }, React.createElement(Icon, { name: isS ? "check" : "plus", size: 18 })), React.createElement('span', { className: "text-[14px] font-bold" }, move)),
                                                React.createElement('button', { onClick: (e) => { e.stopPropagation(); watchYoutube(move); }, className: "touch-target text-red-300" }, React.createElement(Icon, { name: "youtube", size: 20 }))
                                            ),
                                            isS && React.createElement('div', { className: "flex gap-4 pt-1 border-t border-orange-50 text-[12px] font-bold text-[#5a6a7a]" },
                                                React.createElement('div', { className: "flex-1 flex items-center bg-[#f2f4f7] rounded-xl px-2 py-1.5" }, React.createElement('button', { onClick: () => updateEx(move, 'sets', -1), className: "stepper-btn" }, "-"), React.createElement('span', { className: "flex-1 text-center" }, `${cE.sets}ÁµÑ`), React.createElement('button', { onClick: () => updateEx(move, 'sets', 1), className: "stepper-btn" }, "+")),
                                                React.createElement('div', { className: "flex-1 flex items-center bg-[#f2f4f7] rounded-xl px-2 py-1.5" }, React.createElement('button', { onClick: () => updateEx(move, 'reps', -1), className: "stepper-btn" }, "-"), React.createElement('span', { className: "flex-1 text-center" }, `${cE.reps}Ê¨°`), React.createElement('button', { onClick: () => updateEx(move, 'reps', 1), className: "stepper-btn" }, "+"))
                                            )
                                        );
                                    }))),
                                    React.createElement('div', null, React.createElement('span', { className: "text-[16px] font-bold text-[#5a6a7a] mb-2 block" }, "Ë®ìÁ∑¥Á≠ÜË®ò"), React.createElement('textarea', { value: w_note, onChange: e => setWNote(e.target.value), placeholder: "Â¶≥‰ªäÂ§©ÁöÑÂøÉÊÉÖÂ¶Ç‰ΩïÔºü", className: "note-textarea bg-blue-50/50 text-brand" }))
                                ) : React.createElement('div', { className: "space-y-4 text-brand" },
                                    React.createElement('div', { className: "flex items-center justify-between bg-blue-50/50 p-6 rounded-[24px] text-[#f9991a] shadow-inner text-brand" },
                                        React.createElement('div', { className: "flex items-center gap-4" }, React.createElement(Icon, { name: "droplets", size: 26 }), React.createElement('div', { className: "flex items-baseline min-w-[110px] text-[#040316]" }, React.createElement('input', { type: "number", value: d_water, onChange: e => setDWater(e.target.value), className: "w-24 bg-transparent text-[28px] font-bold outline-none" }), React.createElement('span', { className: "text-[14px] font-bold text-[#9caeba] ml-1" }, "cc"))),
                                        React.createElement('div', { className: "flex gap-2 text-brand" }, React.createElement('button', { onClick: () => setDWater(Math.max(0, Number(d_water) - 250)), className: "w-10 h-10 bg-white rounded-xl shadow-sm font-bold text-[#040316]" }, "-"), React.createElement('button', { onClick: () => setDWater(Number(d_water) + 250), className: "w-10 h-10 bg-[#f9991a] text-white rounded-xl shadow-md" }, "+"))
                                    ),
                                    ['breakfast', 'lunch', 'dinner', 'snacks'].map(meal => React.createElement('div', { key: meal, className: "space-y-2 text-brand" },
                                        React.createElement('p', { className: "text-[16px] font-bold text-[#5a6a7a] mb-2" }, meal === 'breakfast' ? 'Êó©È§ê' : meal === 'lunch' ? 'ÂçàÈ§ê' : meal === 'dinner' ? 'ÊôöÈ§ê' : 'ÈªûÂøÉ'),
                                        React.createElement('textarea', { value: dietForm[meal], onChange: e => setDietForm(p => ({ ...p, [meal]: e.target.value })), rows: "2", placeholder: "Á¥ÄÈåÑÂ¶≥ÁöÑÈ§êÈªû...", className: "text-[14px] p-3 bg-blue-50/50 rounded-xl w-full border-none outline-none text-[#040316] text-brand" }),
                                        React.createElement('div', { className: "flex gap-2 overflow-x-auto no-scrollbar pt-1 items-center" },
                                            quickFoods[meal]?.map(f => React.createElement('div', { key: f, className: "relative group" },
                                                React.createElement('button', { onClick: () => handleQuickFoodSelect(meal, f), className: "tag-btn text-[12px] bg-white border-gray-100 pr-8" }, f),
                                                React.createElement('button', { onClick: (e) => { e.stopPropagation(); confirmDelete('quickFood', f, meal); }, className: "absolute right-1 top-1/2 -translate-y-1/2 touch-target text-red-300" }, React.createElement(Icon, { name: "x-circle", size: 14 }))
                                            )),
                                            React.createElement('div', { className: "flex items-center gap-1 bg-blue-100/30 pl-3 pr-1 rounded-xl h-9 border border-blue-100" },
                                                React.createElement('input', { value: customFoodInput[meal], onChange: e => setCustomFoodInput(p => ({ ...p, [meal]: e.target.value })), placeholder: "Âø´Êç∑...", className: "bg-transparent w-12 text-[12px] outline-none" }),
                                                React.createElement('button', { onClick: () => { if (!customFoodInput[meal]) return; setQuickFoods(p => ({ ...p, [meal]: [...p[meal], customFoodInput[meal]] })); setCustomFoodInput(p => ({ ...p, [meal]: '' })); }, className: "touch-target !w-7 !h-7 bg-[#f9991a] text-white rounded-lg" }, React.createElement(Icon, { name: "plus", size: 14 }))
                                            )
                                        )
                                    ))
                                )
                            )
                        ),
                        // Ë¶ÅÊ±ÇÔºöÊåâÈàïÂõ∫ÂÆöÂú®Â∫ïÈÉ®ÔºåÁïôÁôΩ 16px
                        React.createElement('div', { className: "p-4 bg-white border-t border-gray-50 pb-4 text-brand" }, React.createElement('button', { onClick: handleSaveEntry, disabled: isSaving, className: "primary-btn w-full shadow-lg text-white flex items-center justify-center gap-2" }, isSaving ? "ÂêåÊ≠•‰∏≠..." : "ÂÑ≤Â≠òÁ¥ÄÈåÑ"))
                    )
                ),

                showPlanModal && React.createElement('div', { className: "sheet-container text-[#040316]" },
                    React.createElement('div', { className: "sheet-backdrop", onClick: closeModal }),
                    React.createElement('div', { className: "sheet-content" },
                        React.createElement('header', { className: "h-[64px] px-4 flex justify-between items-center border-b border-gray-50 bg-white sticky top-0 z-20 text-brand" },
                            React.createElement('div', { className: "w-10 text-brand" }),
                            React.createElement('h3', { className: "text-[18px] font-bold text-[#5a6a7a]" }, editingPlanId ? 'Á∑®ËºØÁõÆÊ®ô' : 'ÂïüÂãïÊñ∞ÁõÆÊ®ô'),
                            React.createElement('div', { onClick: closeModal, className: "touch-target text-[#9caeba]" }, React.createElement(Icon, { name: "x", size: 24 }))
                        ),
                        React.createElement('div', { className: "flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar text-brand" },
                            React.createElement('div', null, React.createElement('span', { className: "font-bold mb-2 block text-[#5a6a7a] text-[16px]" }, "Ë®àÁï´ÂêçÁ®±"), React.createElement('input', { value: newPlanTitle, onChange: e => setNewPlanTitle(e.target.value), placeholder: "È¶ñÁàæË°ùÂà∫ 14 Â§©", className: "text-[14px] w-full bg-blue-50/50 rounded-xl h-11 px-3 outline-none" })),
                            React.createElement('div', null, React.createElement('span', { className: "font-bold mb-2 block text-[#5a6a7a] text-[16px]" }, "ÁõÆÊ®ôÊó•Êúü"), React.createElement('input', { type: "date", value: newPlanDate, onChange: e => setNewPlanDate(e.target.value), className: "text-[14px] w-full bg-blue-50/50 rounded-xl h-11 px-3 outline-none" }), !editingPlanId && React.createElement('div', { className: "flex gap-2 pt-2 text-brand" }, [7, 14, 30].map(d => React.createElement('button', { key: d, onClick: () => { const obj = new Date(); obj.setDate(obj.getDate() + d); setNewPlanDate(obj.toISOString().split('T')[0]); }, className: "tag-btn text-[12px]" }, `+${d}Â§©`)))),
                            React.createElement('div', null, React.createElement('span', { className: "font-bold mb-2 block text-[#5a6a7a] text-[16px]" }, "È´îÊÖãË®≠ÂÆö"), React.createElement('div', { className: "flex items-center gap-2 text-brand" },
                                React.createElement('div', { className: "weight-input-card flex-1 p-4 bg-blue-50/50 rounded-[20px] flex flex-col items-center gap-1" }, React.createElement('span', { className: "text-[11px] font-bold text-[#9caeba] uppercase" }, "Ëµ∑Âßã"), React.createElement('div', { className: "flex items-baseline" }, React.createElement('input', { type: "number", step: "0.1", value: newPlanBaselineWeight, onChange: e => setNewPlanBaselineWeight(e.target.value), placeholder: "54.0", className: "w-16 bg-transparent text-center text-[20px] font-bold outline-none" }), React.createElement('span', { className: "text-[12px] font-bold text-[#9caeba] ml-0.5" }, "kg"))),
                                React.createElement(Icon, { name: "chevron-right", size: 24, className: "text-[#f9991a] opacity-30" }),
                                React.createElement('div', { className: "weight-input-card flex-1 bg-orange-50/30 p-4 rounded-[20px] flex flex-col items-center gap-1 border border-orange-100" }, React.createElement('span', { className: "text-[11px] font-bold text-[#f9991a] uppercase text-brand" }, "ÁõÆÊ®ô"), React.createElement('div', { className: "flex items-baseline" }, React.createElement('input', { type: "number", step: "0.1", value: newPlanTargetWeight, onChange: e => setNewPlanTargetWeight(e.target.value), placeholder: "50.0", className: "!text-[#f9991a] w-16 bg-transparent text-center text-[20px] font-bold outline-none" }), React.createElement('span', { className: "text-[12px] font-bold text-[#f9991a] ml-0.5" }, "kg")))
                            ))
                        ),
                        React.createElement('div', { className: "p-4 bg-white border-t border-gray-50 pb-4 text-brand" }, React.createElement('button', { onClick: handleCreatePlan, disabled: isSaving || !newPlanDate || !newPlanTitle, className: "primary-btn w-full shadow-lg font-bold tracking-widest uppercase text-brand" }, isSaving ? "ÂêåÊ≠•‰∏≠..." : "ÂïüÂãïË®àÁï´"))
                    )
                ),

                showConfirmModal && React.createElement('div', { className: "fixed inset-0 z-[2000] flex items-center justify-center p-6 text-brand" },
                    React.createElement('div', { className: "absolute inset-0 bg-black/40 backdrop-blur-sm", onClick: () => setShowConfirmModal(false) }),
                    React.createElement('div', { className: "modal-center-content relative z-10 w-full max-w-[320px] bg-white rounded-[32px] p-6 shadow-2xl text-center text-brand" },
                        React.createElement('div', { className: "w-16 h-16 bg-red-50 rounded-full flex items-center justify-center text-red-500 mx-auto mb-4" }, React.createElement(Icon, { name: "alert-triangle", size: 32 })),
                        React.createElement('h3', { className: "text-[18px] font-bold mb-2" }, "Á¢∫Ë™çË¶ÅÂà™Èô§ÂóéÔºü"),
                        React.createElement('p', { className: "text-[14px] text-[#7a8b9a] leading-relaxed mb-6" }, "Âà™Èô§ÂæåË≥áÊñôÂ∞áÁÑ°Ê≥ïÂæ©ÂéüÔºå", React.createElement('br'), "Ë´ãÁ¢∫Ë™çÊòØÂê¶ÁπºÁ∫åÂü∑Ë°åÔºü"),
                        React.createElement('div', { className: "flex gap-3 text-brand" },
                            React.createElement('button', { onClick: () => setShowConfirmModal(false), className: "flex-1 h-12 bg-gray-100 rounded-2xl font-bold text-[#5a6a7a] active:scale-95 transition-all text-brand" }, "‰∏çÔºåÂèñÊ∂à"),
                            React.createElement('button', { onClick: executeDelete, className: "flex-1 h-12 bg-red-500 text-white rounded-2xl font-bold active:scale-95 transition-all shadow-lg shadow-red-200 text-brand" }, "ÊòØÁöÑÔºåÂà™Èô§")
                        )
                    )
                )
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>
